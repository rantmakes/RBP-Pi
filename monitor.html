<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Roastmaster RDP Monitor</title>
    <style>
        body { font-family: 'Courier New', monospace; background: #1a1a1a; color: #00ff00; padding: 20px; }
        .container { max-width: 900px; margin: 0 auto; border: 1px solid #333; padding: 20px; background: #000; }
        h1 { border-bottom: 1px solid #00ff00; padding-bottom: 10px; font-size: 1.5em; }
        
        .stat-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px; }
        .stat-box { background: #111; padding: 10px; border: 1px solid #333; }
        .label { color: #888; font-size: 0.8em; display: block; margin-bottom: 5px; }
        .value { font-weight: bold; color: #fff; font-size: 1.1em; }
        
        pre { background: #111; padding: 15px; border: 1px solid #333; white-space: pre-wrap; word-wrap: break-word; color: #dcdcdc; }
        
        .status-dot { height: 12px; width: 12px; background-color: #555; border-radius: 50%; display: inline-block; margin-right: 10px; }
        .active { background-color: #00ff00; box-shadow: 0 0 8px #00ff00; transition: background-color 0.1s; }
        
        .highlight { color: #569cd6; } /* JSON Key Color */
        .string { color: #ce9178; }    /* JSON String Color */
        .number { color: #b5cea8; }    /* JSON Number Color */
    </style>
</head>
<body>

<div class="container">
    <h1><span id="activity" class="status-dot"></span>RDP Packet Monitor</h1>
    
    <div class="stat-grid">
        <div class="stat-box">
            <span class="label">Host Serial</span>
            <span id="serial" class="value">Waiting...</span>
        </div>
        <div class="stat-box">
            <span class="label">Epoch ID</span>
            <span id="epoch" class="value">--</span>
        </div>
        <div class="stat-box">
            <span class="label">Event Type</span>
            <span id="eventType" class="value">--</span>
        </div>
        <div class="stat-box">
            <span class="label">Data Streams</span>
            <span id="streamCount" class="value">--</span>
        </div>
    </div>

    <h3>Live Datagram (Formatted)</h3>
    <pre id="rawPayload">Waiting for data...</pre>
</div>

<script>
    const EVENT_TYPES = { 1: "SYN (Handshake)", 2: "ACK (Response)", 3: "TEMP (Data)" };
    const META_TYPES = { 
        3000: "Bean Temp", 3001: "Env Temp", 3002: "Max Env Temp", 
        3004: "Exhaust", 3005: "Ambient", 3006: "Cooling" 
    };

    async function updateData() {
        try {
            // Fetch the compact JSON file with a cache-busting parameter
            const response = await fetch('rdp_packet.json?nocache=' + new Date().getTime());
            
            if (!response.ok) throw new Error("File not found");
            
            const data = await response.json();

            // Update Header Info
            document.getElementById('serial').textContent = data.RPSerial || "Unknown";
            document.getElementById('epoch').textContent = data.RPEpoch ? data.RPEpoch.toFixed(3) : "--";
            
            // Analyze Payload
            let typeStr = "Unknown";
            let streamCount = 0;

            if (Array.isArray(data.RPPayload) && data.RPPayload.length > 0) {
                // Determine Event Type from the first item in the payload array
                const typeCode = data.RPPayload[0].RPEventType;
                typeStr = EVENT_TYPES[typeCode] || ("Type " + typeCode);
                streamCount = data.RPPayload.length;
            }

            document.getElementById('eventType').textContent = typeStr;
            document.getElementById('streamCount').textContent = streamCount;

            // PRETTY PRINT: Convert the compact object back to a formatted string with 4-space indentation
            document.getElementById('rawPayload').textContent = JSON.stringify(data, null, 4);

            // Blink effect to show activity
            const dot = document.getElementById('activity');
            dot.classList.add('active');
            setTimeout(() => dot.classList.remove('active'), 200);

        } catch (error) {
            console.error('Error fetching data:', error);
            document.getElementById('rawPayload').textContent = "Error: " + error.message;
        }
    }

    // Poll every 1 second
    setInterval(updateData, 1000);
    updateData(); // Initial call
</script>

</body>
</html>
